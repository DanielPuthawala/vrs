# VR uses yaml as the source document for json schema
#
# To convert vr.yaml to vr.json:
#   make vr.json
# You'll probably have to `pip install pyyaml` first.
#
# To watch for changes and update automatically:
#   make watch &

# https://json-schema.org/understanding-json-schema/reference/schema.html
$schema: "http://json-schema.org/draft-04/schema"
title: "GA4GH-VR-Definitions"
type: object

definitions:
  # VR definitions are presented top-down.  Everything rolls up to
  # Variation, which is a polymorphic abstraction of many kinds of
  # variation.


  ############################################################################
  # Locations

  Location:
    additionalProperties: false
    description: >-
      A Location represents a span on a molecule in a coordinate system.
    oneOf:
      - $ref: "#/definitions/UnorientedLocation"
      - $ref: "#/definitions/OrientedLocation"
    discriminator:
      propertyName: type

  GeneLocation:
    type: object
    properties:
      type:
        type: string
        enum: [GeneLocation]
        default: GeneLocation
      _id:
        $ref: "#/definitions/CURIE"
      gene_id:
        $ref: "#/definitions/CURIE"
      interval:
        $ref: "#/definitions/Interval"
    additionalProperties: false
    required:
      - type
      - gene_id
      - interval

  ChromosomeLocation:
    type: object
    properties:
      type:
        type: string
        enum: [ChromosomeLocation]
        default: ChromosomeLocation
      _id:
        $ref: "#/definitions/CURIE"
      species_id:
        $ref: "#/definitions/CURIE"
      chr:
        type: string
      interval:
        $ref: "#/definitions/Interval"
    additionalProperties: false
    required:
      - type
      - species_id
      - chr
      - interval
    
  SequenceLocation:
    additionalProperties: false
    description: >-
      A segment of a reference sequence
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [SequenceLocation]
        default: SequenceLocation
      sequence_id:
        $ref: "#/definitions/CURIE"
      interval:
        $ref: "#/definitions/Interval"
    required:
      - type
      - sequence_id
      - interval

  UnorientedLocation:
    additionalProperties: false
    description: >-
      A Location represents a span on a molecule in a coordinate system.
    oneOf:
      - $ref: "#/definitions/ChromosomeLocation"
      - $ref: "#/definitions/SequenceLocation"
      - $ref: "#/definitions/GeneLocation"
    discriminator:
      propertyName: type

  OrientedLocation:
    additionalProperties: false
    description: >-
      A specified orientation on another Location. Useful for composition of
      structural variations.
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [OrientedLocation]
        default: OrientedLocation
      unorientedLocation:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/UnorientedLocation"
      orientation:
        type: string
        enum: ['+', '-']
        default: '+'
    required:
      - type
      - unorientedLocation
      - orientation

  ############################################################################
  # Interval
  # * SimpleInterval

  Interval:
    additionalProperties: false
    oneOf:
      - $ref: '#/definitions/SimpleInterval'
      - $ref: '#/definitions/NamedInterval'
      - $ref: '#/definitions/UndefinedInterval'
    discriminator:
      propertyName: type

  SimpleInterval:
    description: >-
      A SimpleInterval represents a span of sequence. Positions are
      always represented by contiguous spans using interbase
      coordinates.

      This definition of Interval is intended to be compatible with that
      in Sequence Ontology
      ([SO:0000001](http://www.sequenceontology.org/browser/current_svn/term/SO:0000001)),
      with the exception that the GA4GH VR Interval may be
      zero-width. The SO definition is for an "extent greater than
      zero".
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [SimpleInterval]
        default: SimpleInterval
      start:
        type: integer
        nullable: true
      end:
        type: integer
        nullable: true
    required:
      - type
      - start
      - end
    example:
      type: SimpleInterval
      start: 11
      end: 22

  NamedInterval:
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [NamedInterval]
        default: NamedInterval
      start:
        type: string
      end:
        type: string
    required:
      - type
      - start
      - end
    example:
      type: NamedInterval
      start: q22.2
      end: q22.3


  UndefinedInterval:
    additionalProperties: false
    type: object
    description: >-
      This interval type covers an undefined span of the object it is associated to in a Location. This is useful for describing a Sequence, Chromosome, Gene, or other entity Location in general terms when the interval is not specified.
    properties:
      type:
        type: string
        enum: [UndefinedInterval]
        default: UndefinedInterval
    required:
      - type

  ############################################################################
  # Variation

  Variation:
    additionalProperties: false
    description: >-
      The root class of all Variation types
    oneOf:
      - $ref: "#/definitions/Allele"
      - $ref: "#/definitions/Text"
      - $ref: "#/definitions/VariationSet"
      - $ref: "#/definitions/LocationJunction"
      - $ref: "#/definitions/Abundance"
    discriminator:
      propertyName: type

  MolecularVariation:
    additionalProperties: false
    description: >-
      A subset of Variation describing a single resultant molecule.
    oneOf:
      - $ref: "#/definitions/Allele"
      - $ref: "#/definitions/LocationJunction"
    discriminator:
      propertyName: type

  Abundance:
    additionalProperties: false
    description: >-
      Defines the abundance of a MolecularVariation in a systemic context. Some common
      uses of abundance include transcript / gene expression and CNVs.
    oneOf:
      - $ref: "#/definitions/DiscreteCopyNumber"
      - $ref: "#/definitions/RelativeAbundance"
    discriminator:
      propertyName: type

  DiscreteCopyNumber:
    additionalProperties: false
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [DiscreteCopyNumber]
        default: DiscreteCopyNumber
      molecularVariation:
        $ref: "#/definitions/MolecularVariation"
      minCopies:
        type: integer
      maxCopies:
        type: integer
    required:
      - type
      - molecularVariation

  RelativeAbundance:
    additionalProperties: false
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [RelativeAbundance]
        default: RelativeAbundance
      molecularVariation:
        $ref: "#/definitions/MolecularVariation"
      relativeQuantity:
        type: string
        enum: [greater_than, less_than, equal_to]
    required:
      - type
      - molecularVariation
      - relativeQuantity

  Text:
    additionalProperties: false
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [Text]
        default: Text
      definition:
        type: string
        description: >-
          An textual representation of variation intended to capture
          variation descriptions that cannot be parsed, but still
          treated as variation.

  Allele:
    additionalProperties: false
    description: An assertion of a sequence state at a Location.
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [Allele]
        default: Allele
      location:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Location"
      state:
        $ref: "#/definitions/State"


  VariationSet:
    description: >-
      A set of Variation
    type: "object"
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: ["VariationSet"]
        default: "VariationSet"
      members:
        type: array
        uniqueItems: true
        items:
          oneOf:
            - $ref: "#/definitions/Variation"
            - $ref: "#/definitions/CURIE"


  Haplotype:
    additionalProperties: false
    description: >-
      A set of zero or more Alleles
    type: "object"
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: ["Haplotype"]
        default: "Haplotype"
      location:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Location"
        default: null
      members:
        type: array
        minItems: 1
        uniqueItems: true
        items:
          oneOf:
            - $ref: "#/definitions/Allele"
            - $ref: "#/definitions/CURIE"

  LocationJunction:
    additionalProperties: false
    description: >-
      A junction between two oriented Locations, where "left" corresponds to the 5'
      partner for nucleic acids, or N-terminus partner for amino acids, and "right"
      corresponds to the 3' and C-terminus partner, respectively.
    type: "object"
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: ["LocationJunction"]
        default: "LocationJunction"
      left:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Location"
      right:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Location"
    required:
      - type



  ############################################################################
  # States

  State:
    oneOf:
      - $ref: "#/definitions/SequenceState"
      - $ref: "#/definitions/ChromosomeState"
      - $ref: "#/definitions/AmbiguousState"

  SequenceState:
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [SequenceState]
        default: SequenceState
      sequence:
        type: string
        nullable: false
    required:
      - type
      - sequence
    example:
      type: SequenceState
      sequence: C

  ChromosomeState:
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [ChromosomeState]
        default: ChromosomeState
      molecularRegion:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Location"
    required:
      - type

  AmbiguousState:
    additionalProperties: false
    description: >-
      Used for explicitly defining an ambiguous or unknown State at a molecule Location.
    type: object
    properties:
      type:
        type: string
        enum: [AmbiguousState]
        default: AmbiguousState
    required:
      - type

  ############################################################################
  # Basic types
  # These types are used solely within other definitions.

  DateTime:
    additionalProperties: false
    type: string
    format: "date-time"

  CURIE:
    additionalProperties: false
    description: >-
      A string that refers to an object uniquely.  The lifetime and
      scope of an id is defined by the sender.

      VR does not impose any contraints on strings used as ids in
      messages. However, to maximize sharability of data, the VR
      Specification RECOMMENDS that implementations use [W3C Compact
      URI (CURIE)](https://www.w3.org/TR/curie/) syntax.

      String CURIEs are represented as `prefix`:`reference` (W3C
      terminology), but often referred to as `namespace`:`accession`
      or `namespace`:`local id` colloquially.

      The VR specification also RECOMMENDS that `prefix` be defined in
      identifiers.org.

      The `reference` component is an unconstrained string.

      A CURIE is a URI.  URIs may *locate* objects (i.e., specify
      where to retrieve them) or *name* objects conceptually.  VR uses
      CURIEs primarily as a naming mechanism.

      Implementations MAY provide CURIE resolution mechanisms for
      prefixes to make these objects locatable.

      Using internal ids in public messages is strongly discouraged.

    type: string
    pattern: '^\w[^:]*:.+$'
    example: "ensembl:ENSG00000139618"
